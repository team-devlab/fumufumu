name: Frontend Code Check (Biome & Tests)

on:
  pull_request:
    branches: [main, master]

jobs:
  frontend_quality:
    name: Biome & Vitest Check
    runs-on: ubuntu-latest

    defaults:
      run:
        working-directory: apps/fumufumu-frontend/
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        
      - name: Setup Node.jsand pnpm
        uses: actions/setup-node@v6
        with:
          node-version: 20
          pnpm-version: 9 # pnpm をインストールして PATH に通す
          cache: 'pnpm' # pnpmを使用しているため、キャッシュをpnpmに設定
      
      - name: Install dependencies
        # pnpm-workspace.yamlがあるため pnpm install を実行し、依存関係を解決
        run: pnpm install --frozen-lockfile

      # Biomeのセットアップ（バージョンを自動検出）
      - name: Setup Biome CLI
        uses: biomejs/setup-biome@v2

      # format, lint, organize imports のチェックを同時に実行（ファイルへの書き込みは行わない）
      - name: Run Biome CI
        run: pnpm exec biome ci
      
      - name: Run Vitest Tests
        run: pnpm test
